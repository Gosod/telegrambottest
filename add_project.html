<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .subtitle {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 24px;
            animation: fadeIn 0.3s ease-out;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 12px;
            font-size: 15px;
        }

        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
        }

        .hint {
            font-size: 13px;
            color: var(--tg-theme-hint-color, #999);
            margin-top: 8px;
        }

        .preview {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 16px;
            font-size: 16px;
        }

        .project-preview {
            background: var(--tg-theme-bg-color, #fff);
            border: 2px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 12px;
            padding: 20px 16px;
            text-align: center;
            display: inline-block;
            min-width: 140px;
        }

        .preview-abbr {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--tg-theme-button-color, #0088cc);
        }

        .preview-name {
            font-size: 13px;
            opacity: 0.8;
        }

        .existing-projects {
            margin-top: 24px;
        }

        .existing-title {
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .existing-card {
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
        }

        .existing-abbr {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .existing-name {
            font-size: 12px;
            opacity: 0.7;
        }

        .error {
            color: #ff3b30;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .info-card {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-left: 4px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</h1>
        <div class="subtitle">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏</div>

        <div class="info-card">
            üí° –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ - —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (2-4 –±—É–∫–≤—ã), –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
        </div>

        <form id="projectForm">
            <!-- –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ -->
            <div class="form-group">
                <label>üî§ –ê–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞</label>
                <input 
                    type="text" 
                    id="abbr" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–°"
                    maxlength="5"
                    required
                >
                <div class="hint">2-5 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–¥–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ</div>
                <div class="error" id="abbrError">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –ø–æ–ª–µ</div>
            </div>

            <!-- –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="form-group">
                <label>üìù –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                <input 
                    type="text" 
                    id="fullName" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞"
                    maxlength="50"
                    required
                >
                <div class="hint">–î–æ 50 —Å–∏–º–≤–æ–ª–æ–≤</div>
                <div class="error" id="nameError">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –ø–æ–ª–µ</div>
            </div>

            <!-- –ü—Ä–µ–≤—å—é -->
            <div class="preview" id="previewSection" style="display: none;">
                <div class="preview-title">üëÅÔ∏è –ö–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å:</div>
                <div class="project-preview">
                    <div class="preview-abbr" id="previewAbbr">–†–°</div>
                    <div class="preview-name" id="previewName">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞</div>
                </div>
            </div>
        </form>

        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã -->
        <div class="existing-projects">
            <div class="existing-title">üìÅ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã:</div>
            <div class="projects-grid" id="existingProjects">
                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã (–ø–æ–ª—É—á–∞–µ–º –æ—Ç –±–æ—Ç–∞)
        const existingProjects = [
            {"abbr": "–†–°", "full": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞"},
            {"abbr": "–ú–†–ö", "full": "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"},
            {"abbr": "–ö–ü", "full": "–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞"},
            {"abbr": "–î–ó", "full": "–î–∏–∑–∞–π–Ω"},
            {"abbr": "–¢–°–¢", "full": "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"}
        ];

        const abbrInput = document.getElementById('abbr');
        const fullNameInput = document.getElementById('fullName');
        const previewSection = document.getElementById('previewSection');
        const previewAbbr = document.getElementById('previewAbbr');
        const previewName = document.getElementById('previewName');

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
        const existingContainer = document.getElementById('existingProjects');
        existingProjects.forEach(project => {
            const card = document.createElement('div');
            card.className = 'existing-card';
            card.innerHTML = `
                <div class="existing-abbr">${project.abbr}</div>
                <div class="existing-name">${project.full}</div>
            `;
            existingContainer.appendChild(card);
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function updatePreview() {
            const abbr = abbrInput.value.trim().toUpperCase();
            const fullName = fullNameInput.value.trim();

            if (abbr || fullName) {
                previewSection.style.display = 'block';
                previewAbbr.textContent = abbr || '–ê–ë–ë';
                previewName.textContent = fullName || '–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ';
            } else {
                previewSection.style.display = 'none';
            }
        }

        abbrInput.addEventListener('input', (e) => {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ–º uppercase
            e.target.value = e.target.value.toUpperCase();
            updatePreview();
            document.getElementById('abbrError').classList.remove('show');
        });

        fullNameInput.addEventListener('input', () => {
            updatePreview();
            document.getElementById('nameError').classList.remove('show');
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        function validate() {
            const abbr = abbrInput.value.trim();
            const fullName = fullNameInput.value.trim();
            let isValid = true;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã
            if (!abbr || abbr.length < 2) {
                document.getElementById('abbrError').textContent = '–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞';
                document.getElementById('abbrError').classList.add('show');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
            if (!fullName || fullName.length < 3) {
                document.getElementById('nameError').textContent = '–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                document.getElementById('nameError').classList.add('show');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
            const duplicate = existingProjects.find(
                p => p.abbr.toUpperCase() === abbr.toUpperCase() || 
                     p.full.toLowerCase() === fullName.toLowerCase()
            );

            if (duplicate) {
                if (duplicate.abbr.toUpperCase() === abbr.toUpperCase()) {
                    document.getElementById('abbrError').textContent = '–¢–∞–∫–∞—è –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                    document.getElementById('abbrError').classList.add('show');
                } else {
                    document.getElementById('nameError').textContent = '–¢–∞–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                    document.getElementById('nameError').classList.add('show');
                }
                isValid = false;
            }

            return isValid;
        }

        // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ Telegram
        tg.MainButton.setText('‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç');
        tg.MainButton.show();
        tg.MainButton.onClick(() => {
            if (!validate()) {
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const data = {
                abbr: abbrInput.value.trim().toUpperCase(),
                full: fullNameInput.value.trim()
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É
            tg.sendData(JSON.stringify(data));
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º
            tg.close();
        });

        console.log('Add project WebApp loaded');
    </script>
</body>
</html>
